<style>
    .user_msg{
        text-align: right;
        margin-left: 30%;
        display: flex;
        flex-direction: row-reverse;  
        font-synthesis: none;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-text-size-adjust: 100%;
        font-size: 5vw;
    }
    .waiting_msg{
        text-align: left;
        margin-right: 30%;
        display: flex;
        flex-direction: row;  
        font-synthesis: none;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-text-size-adjust: 100%;
        font-size: 5vw;
    }
    .dbbot_msg{
        text-align: left;
        margin-right: 30%;
        display: flex;
        flex-direction: row;  
        font-synthesis: none;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-text-size-adjust: 100%;
        font-size: 5vw;
    }
</style>

{% include head.html %}

<body class="d-flex h-100">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column" id="home-page">

        {% include header.html %}

            <main class="row pt-4 pb-4">

                <div class="col-12">
                    <div class="pt-5 mb-5">
                        
                        <div id="chat" class="card bg-dark p-3 rounded-bottom-0"></div>
                        <div id="chat-container" class="card bg-dark p-3 rounded-top-0">
                            <div class="input-group mb-0 pt-0 mt-0">
                                <input 
                                    type="text" 
                                    class="form-control form-control-lg" 
                                    name="question" 
                                    id="user-input" 
                                    placeholder="Type question &#x23CE;" 
                                    aria-label="Ask question" 
                                    aria-describedby="question-input"
                                >
                                <button type="submit" id="submit-button" class="btn btn-secondary" onclick="getVal()">Send</button>
                            </div>
                        </div>
                    
                        {{ content }}
                    
                    </div>
                </div>
                
            </main>

            {% include footer.html %}

        </div>

        <script>
            const dbbotResponses = {
                "greetings": ["Yo!", "Wha gwan?", "Hey!", "Word up?"],
                "questions": {
                    "name": ["My name is Dogsbody.", "I'm Dogsbody, nice to meet you!"],
                    "age": ["I don't have an age.", "Age is just a number for bots!"],
                    "default": ["Don't be silly I'm Dogsbody not your mama.", "Yeah I don't understand that."]
                },
                "farewell": ["Goodbye!", "See you later!", "Farewell!", "Bye!"]
            };

            function getResponse(input) {
                const lowerCaseInput = input.toLowerCase();

                if (lowerCaseInput.includes("hello") || lowerCaseInput.includes("hi")) {
                    return getRandomResponse(dbbotResponses.greetings);
                } else if (lowerCaseInput.includes("name")) {
                    return getRandomResponse(dbbotResponses.questions.name);
                } else if (lowerCaseInput.includes("age")) {
                    return getRandomResponse(dbbotResponses.questions.age);
                } else if (lowerCaseInput.includes("bye")) {
                    return getRandomResponse(dbbotResponses.farewell);
                } else {
                    return getRandomResponse(dbbotResponses.questions.default);
                }
            }

            function getRandomResponse(responses) {
                const randomIndex = Math.floor(Math.random() * responses.length);
                return responses[randomIndex];
            }

            async function getVal() {

                const user_chat = document.querySelector('#chat');
                const val = document.querySelector('#user-input').value;
                const submit_btn = document.querySelector('#submit-button');


                $(submit_btn).attr('disabled', true);
                $('input[id="user-input"]').on('keyup', function () {
                    var text_value = $('input[name="question"]').val();
                    if (text_value != '') {
                        $('button[id="submit-button"]').attr('disabled', false);
                    } else {
                        $('button[id="submit-button"]').attr('disabled', true);
                    }
                });

                if (val == '') {
                } else {


                    console.log(val);
                    // Example usage

                    const userInput = val;
                    const botResponse = getResponse(userInput);
                    console.log("Bot:", botResponse);

                    user_chat.innerHTML += `
                        <div class="user_msg rounded-4 bg-primary text-light p-3 px-4 mt-2 text-capitalize" style="border-bottom-right-radius: 0!important;">
                            <div class="container text-center">
                                <p class="text-break mb-0">
                                    `+ val +`
                                </p>
                            </div>
                        </div>

                        <div id="waiting_msg" class="waiting_msg p-3 px-4 mt-2">
                            <div class="dot-flashing"></div>
                        </div>
                    `;

                    const resTimeout = setTimeout(dbResponse, 2000);
                    function dbResponse() {
                        const element = document.getElementById("waiting_msg");
                        element.remove();
                        user_chat.innerHTML += `
                            <div class="bot_msg rounded-4 bg-success text-light p-3 px-4 mt-2 text-capitalize" style="border-bottom-left-radius: 0!important;">
                                <p class="text-break mb-0">
                                    `+ botResponse +`
                                </p>
                            </div>
                        `;
                    }

                    document.querySelector("#user-input").value = '';
                }

            }

            var input = document.getElementById("user-input");//get textarea tag
            //NOW replace this with: var input = document.getElementById("myTextarea")

            // Execute a function when the user presses a key on the keyboard
            input.addEventListener("keypress", function(event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter") {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                document.getElementById("submit-button").click();
            }
            }); 

        </script>

    </body>
</html>